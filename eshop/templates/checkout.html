{% extends "base.html" %}
{% load tags %}
{% load static %}

{% block content %}
<div class="container">
  <br>
  <br>
  <h1 class="text-center">Checkout</h1>
  <div class="row">
    <div class="col-md-7">
      <div id="address">
        {% for address in user.smorteruser.address_set.all %}
        <div class="card">
          <div class="card-title text-end address-title"><i class="fa fa-times cross-icon-big" onClick="remove_address({{ address.id }})"></i></div>
          <div class="card-body" style="padding-top: 0;">
            <p><b>Name:</b> {{address.name}}</p>
            <p><b>Address, Zip:</b> {{address.address1}}, {{address.zip_code}}</p>
            <p><b>City, Country:</b> {{address.city}}, {{address.country}}</p>
          </div>
        </div>
        {% endfor %}
      </div>
      <br>
      <form method="POST" action="{% url 'checkout' %}">
        {% csrf_token %}
        {{ form }}
        <button type="submit" class="btn btn-success">Add Billing address</button>
      </form>

    </div>
    <div class="col-md-5" style="height: 400px; background-color: red;">

    </div>
  </div>
  <br>
</div>
<script>
  function remove_address(id){
    let url = "{% url 'remove_address' %}"
    fetch(url,{
        method: "POST",
        headers:{
            "Content-type": "application/json",
            "X-CSRFToken": getCookie('csrftoken')

        },
        body: JSON.stringify({
            "address_id": id
        })
      }).then(()=>{location.reload()})
    }

  $(document).ready(function() {
    $("#id_country").attr("class", "form-control mb-3")
    $("#id_country > option:first").text("Country")
  })
</script>
{% endblock %}